# ğŸš€ Safer PR Testing: åŸºäº Istio & OpenTelemetry çš„å…±äº« Staging é›†ç¾¤æ–¹æ¡ˆ

## ğŸ“– é¡¹ç›®æ¦‚è¿°

åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œé¢‘ç¹åœ°å°†æ‹‰å–è¯·æ±‚ï¼ˆPRï¼‰ç›´æ¥éƒ¨ç½²åˆ°å…±äº«çš„ **Staging** ç¯å¢ƒå¾€å¾€ä¼šç ´åç¯å¢ƒçš„ç¨³å®šæ€§ã€‚æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªåŸºäº**è¯·æ±‚çº§é€»è¾‘éš”ç¦»**çš„åŸå‹æ–¹æ¡ˆï¼Œé€šè¿‡æµé‡æŸ“è‰²å’Œä¸Šä¸‹æ–‡ä¼ æ’­ï¼Œå®ç°åœ¨ä¸å¢åŠ åŸºç¡€è®¾æ–½å¼€é”€çš„å‰æä¸‹ï¼Œå®‰å…¨åœ°åœ¨å…±äº«é›†ç¾¤ä¸­æµ‹è¯•å¤šä¸ª PRã€‚

### ç›®æ ‡
* **é¿å…å†²çªæµ‹è¯•**ï¼šPR ç‰ˆæœ¬çš„å˜æ›´ä»…å¯¹æŸ“è‰²æµé‡ç”Ÿæ•ˆï¼Œä¸å½±å“ Stable ç¯å¢ƒå’Œå…¶ä»–æˆå‘˜ã€‚
* **èµ„æºé«˜æ•ˆåˆ©ç”¨**ï¼šåœ¨monorepoä¸­ï¼Œæ— éœ€ä¸ºæ¯ä¸ª PR å¤åˆ¶æ•´å¥— Namespaceï¼Œä»…éƒ¨ç½²å˜æ›´çš„æœåŠ¡å®ä¾‹ã€‚
---



## ğŸ—ï¸ æ–¹æ¡ˆæ¶æ„

### è®¾è®¡ç†å¿µ
æ–¹æ¡ˆåŸºäº"**Stable ç‰ˆæœ¬ + PR ç‰ˆæœ¬**"çš„æ··åˆéƒ¨ç½²æ¨¡å¼ï¼Œæ ¸å¿ƒæ¶æ„å¦‚ä¸‹ï¼š

1. **Stable ç‰ˆæœ¬**ï¼šæ‰€æœ‰æœåŠ¡é»˜è®¤éƒ¨ç½²ç¨³å®šç‰ˆæœ¬ï¼Œä½œä¸ºæ•´ä¸ªç³»ç»Ÿçš„åŸºç¡€
2. **PR ç‰ˆæœ¬**ï¼šä»…ä¸ºå˜æ›´çš„æœåŠ¡éƒ¨ç½² PR ç‰ˆæœ¬ï¼Œä½œä¸ºæµ‹è¯•ç›®æ ‡
3. **æµé‡éš”ç¦»**ï¼šé€šè¿‡ Istio å’Œ OpenTelemetry å®ç°è¯·æ±‚çº§çš„æµé‡éš”ç¦»å’Œè·¯ç”±

### æŠ€æœ¯æ ˆ
* **æœåŠ¡ç½‘æ ¼ (Istio)**ï¼šåˆ©ç”¨ Gateway API (`HTTPRoute`) å®ç°åŸºäºè¯·æ±‚å¤´ï¼ˆBaggageï¼‰çš„åŠ¨æ€è·¯ç”±
* **å¯è§‚æµ‹æ€§ (OpenTelemetry)**ï¼šåˆ©ç”¨ `Baggage` æœºåˆ¶å®ç° PR æ ‡è¯†è·¨æœåŠ¡é€æ˜ä¼ æ’­
* **Web æ¡†æ¶ (Go Hertz)**ï¼šé€šè¿‡è‡ªå®šä¹‰ä¸­é—´ä»¶å®ç°æŸ“è‰²æ ‡è¯†çš„æ³¨å…¥ä¸æå–
* **CI/CD (GitHub Actions)**ï¼šå®ç°ä»è·¯å¾„æ£€æµ‹ã€é•œåƒæ„å»ºåˆ° K8s èµ„æºåŠ¨æ€ä¸‹å‘çš„å…¨è‡ªåŠ¨åŒ–

## ğŸ“ é¡¹ç›®ç»“æ„

é¡¹ç›®æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿmonorepoï¼ŒåŒ…å«å››ä¸ªæ ¸å¿ƒå¾®æœåŠ¡ï¼šdetailsã€productpageã€ratingså’Œreviewsã€‚

```
â”œâ”€â”€ details/             # äº§å“è¯¦æƒ…æœåŠ¡
â”‚   â”œâ”€â”€ Dockerfile.details
â”‚   â””â”€â”€ main.go
â”œâ”€â”€ k8s/                 # Kubernetesé…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ baggage.yaml          # Baggageé…ç½®ç¤ºä¾‹
â”‚   â”œâ”€â”€ bookinfo-gateway.yaml # Istioç½‘å…³é…ç½®
â”‚   â”œâ”€â”€ bookinfo-multiversion.yaml # å¤šç‰ˆæœ¬éƒ¨ç½²ç¤ºä¾‹
â”‚   â”œâ”€â”€ bookinfo-namespace.yaml # Namespaceé…ç½®
â”‚   â”œâ”€â”€ bookinfo-stable.yaml  # ç¨³å®šç‰ˆæœ¬éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ bookinfo.yaml         # å®Œæ•´éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ pr-env.yaml.tmpl      # PRç¯å¢ƒæ¨¡æ¿
â”‚   â””â”€â”€ test/                 # æµ‹è¯•é…ç½®
â”œâ”€â”€ pkg/                 # å…¬å…±åŒ…
â”‚   â””â”€â”€ otel/              # OpenTelemetryç›¸å…³ä»£ç 
â”‚       â”œâ”€â”€ hertz_middleware.go  # Hertzä¸­é—´ä»¶
â”‚       â””â”€â”€ init.go              # åˆå§‹åŒ–é…ç½®
â”œâ”€â”€ productpage/         # äº§å“é¡µé¢æœåŠ¡
â”‚   â”œâ”€â”€ Dockerfile.productpage
â”‚   â””â”€â”€ main.go
â”œâ”€â”€ ratings/             # è¯„åˆ†æœåŠ¡
â”‚   â”œâ”€â”€ Dockerfile.ratings
â”‚   â””â”€â”€ main.go
â”œâ”€â”€ reviews/             # è¯„è®ºæœåŠ¡
â”‚   â”œâ”€â”€ Dockerfile.reviews
â”‚   â””â”€â”€ main.go
â”œâ”€â”€ docker.sh            # Dockeræ„å»ºè„šæœ¬
â”œâ”€â”€ go.mod               # Goæ¨¡å—æ–‡ä»¶
â”œâ”€â”€ go.sum               # Goä¾èµ–æ ¡éªŒæ–‡ä»¶
â”œâ”€â”€ README.md            # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ start_services.sh    # æœåŠ¡å¯åŠ¨è„šæœ¬
â””â”€â”€ test.sh              # æµ‹è¯•è„šæœ¬
```

---

## ğŸ› ï¸ å…³é”®æŠ€æœ¯å®ç°

### 1. ä¸Šä¸‹æ–‡ä¼ æ’­ä¸æµé‡æŸ“è‰² (OpenTelemetry)
ä¸ºäº†è®© `x-pr-id` èƒ½å¤Ÿåœ¨æ•´ä¸ªè°ƒç”¨é“¾ä¸­ç©¿é€ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† OTel çš„ **Baggage** æœºåˆ¶ã€‚

> **åŸç†**ï¼šåœ¨å…¥å£å¤„æå– `x-pr-id` å¹¶æ³¨å…¥ `Baggage`ã€‚å³ä½¿ä¸‹æ¸¸æœåŠ¡æ˜¯ Stable ç‰ˆæœ¬ï¼Œå®ƒä¹Ÿä¼šè‡ªåŠ¨å°†æ­¤æ ‡è¯†ä¼ é€’ç»™å®ƒçš„ä¸‹æ¸¸ï¼Œç¡®ä¿æ•´ä¸ªé“¾è·¯çš„è·¯ç”±ä¸€è‡´æ€§ã€‚

**Go ä»£ç é›†æˆç¤ºä¾‹ï¼š**
```go
// pkg/otel/hertz_middleware.go
func Middleware(serviceName string) app.HandlerFunc {
    return func(ctx context.Context, c *app.RequestContext) {
        // ä»è¯·æ±‚å¤´æå–å¹¶æ³¨å…¥ Context Baggage
        if prID := c.GetHeader("x-pr-id"); prID != "" {
            member, _ := baggage.NewMember("pr_id", prID)
            b, _ := baggage.NewBaggage(member)
            ctx = baggage.ContextWithBaggage(ctx, b)
        }
        c.Next(ctx)
    }
}

### 2. æ™ºèƒ½æµé‡è·¯ç”± (Istio)

åˆ©ç”¨ Istio Gateway API (`HTTPRoute`) å®ç°åŸºäº `Baggage` å¤´çš„åŠ¨æ€è·¯ç”±ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°æ­£ç¡®çš„æœåŠ¡ç‰ˆæœ¬ã€‚

#### è·¯ç”±è§„åˆ™ç¤ºä¾‹
```yaml
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: reviews-pr-123-route
  namespace: bookinfo
spec:
  parentRefs:
  - group: ""
    kind: Service
    name: reviews
    port: 9082
  rules:
  # è§„åˆ™A: åŒ¹é…PRæŸ“è‰²æµé‡ (é«˜ä¼˜å…ˆçº§)
  - matches:
    - headers:
      - type: RegularExpression
        name: "baggage"
        value: ".*pr_id=123.*"
    backendRefs:
    - name: reviews-pr-123
      port: 9082

  # è§„åˆ™B: å…œåº•é€»è¾‘ (ä½ä¼˜å…ˆçº§)
  - backendRefs:
    - name: reviews-stable
      port: 9082
```

### 3. è‡ªåŠ¨åŒ–CI/CDæµç¨‹

é€šè¿‡ GitHub Actions å®ç°ä» PR åˆ›å»ºåˆ°èµ„æºæ¸…ç†çš„å…¨è‡ªåŠ¨åŒ–æµç¨‹ï¼š

1. **PRåˆ›å»º/æ›´æ–°**ï¼šè§¦å‘CIç®¡é“
2. **è·¯å¾„æ£€æµ‹**ï¼šè¯†åˆ«å˜åŠ¨çš„æœåŠ¡
3. **é•œåƒæ„å»º**ï¼šä¸ºå˜åŠ¨æœåŠ¡æ„å»ºPRç‰ˆæœ¬é•œåƒ
4. **é…ç½®ç”Ÿæˆ**ï¼šä½¿ç”¨æ¨¡æ¿ç”ŸæˆKuberneteséƒ¨ç½²é…ç½®
5. **éƒ¨ç½²PRç‰ˆæœ¬**ï¼šåœ¨Stagingé›†ç¾¤éƒ¨ç½²PRæœåŠ¡å’Œè·¯ç”±è§„åˆ™
6. **è¿è¡Œæµ‹è¯•**ï¼šå‘é€å¸¦`x-pr-id`å¤´çš„æµ‹è¯•è¯·æ±‚
<!-- 7. **èµ„æºæ¸…ç†**ï¼šPRåˆå¹¶æˆ–å…³é—­ååˆ é™¤ç›¸å…³èµ„æº -->

---

## ğŸ”„ æœåŠ¡è°ƒç”¨å…³ç³»

### æœåŠ¡æ¦‚è¿°
é¡¹ç›®åŒ…å«å››ä¸ªæ ¸å¿ƒæœåŠ¡ï¼Œé€šè¿‡HTTPæ¥å£é€šä¿¡å½¢æˆå®Œæ•´è°ƒç”¨é“¾ï¼š

| æœåŠ¡åç§° | ç«¯å£ | ä¸»è¦åŠŸèƒ½ | ä¾èµ–æœåŠ¡ |
|---------|------|---------|---------|
| productpage | 9083 | å‰ç«¯æœåŠ¡ï¼Œå±•ç¤ºäº§å“ä¿¡æ¯ | reviews, details |
| reviews | 9082 | æä¾›äº§å“è¯„è®ºæ•°æ® | ratings |
| ratings | 9080 | æä¾›äº§å“è¯„åˆ†æ•°æ® | æ—  |
| details | 9081 | æä¾›äº§å“è¯¦æƒ…æ•°æ® | æ—  |

### ç‰ˆæœ¬éƒ¨ç½²è§„åˆ™
1. **Stableç‰ˆæœ¬**ï¼š
   - æ‰€æœ‰æœåŠ¡é»˜è®¤éƒ¨ç½²ï¼Œå‘½åæ ¼å¼ä¸º`service-stable`
   - å¤„ç†æ— `x-pr-id`å¤´çš„è¯·æ±‚
   - ä»£è¡¨å½“å‰ç¨³å®šå‘å¸ƒç‰ˆæœ¬

2. **PRç‰ˆæœ¬**ï¼š
   - ä»…å˜æ›´æœåŠ¡éƒ¨ç½²ï¼Œå‘½åæ ¼å¼ä¸º`service-pr-{pr-id}`
   - å¤„ç†å¸¦`x-pr-id`å¤´çš„è¯·æ±‚
   - ä¸ºæ¯ä¸ªPRåˆ›å»ºç‹¬ç«‹æœåŠ¡å®ä¾‹
   - æµ‹è¯•é€šè¿‡åå¯åˆå¹¶åˆ°Stableç‰ˆæœ¬

### è°ƒç”¨å…³ç³»ç¤ºä¾‹

#### PRæµé‡è°ƒç”¨å…³ç³»ï¼ˆReviewsæœåŠ¡PR #123ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client Request      â”‚
â”‚ (x-pr-id: 123)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ productpage-stable  â”‚  (æœªå˜æ›´ï¼Œæ— PRç‰ˆæœ¬)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ reviews-pr-123  â”‚ â”‚ details-stable  â”‚  (æœªå˜æ›´ï¼Œæ— PRç‰ˆæœ¬)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ratings-stable     â”‚  (æœªå˜æ›´ï¼Œæ— PRç‰ˆæœ¬)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç¨³å®šæµé‡è°ƒç”¨å…³ç³»
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client Request      â”‚
â”‚ (æ— x-pr-idå¤´)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ productpage-stable  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ reviews-stable  â”‚ â”‚ details-stable  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ratings-stable     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®Œæ•´è°ƒç”¨é“¾
```
# PRæµé‡è¯·æ±‚é“¾ï¼ˆReviewsæœåŠ¡PR #123ï¼‰
Client (x-pr-id: 123) â†’ productpage-stable â†’ details-stable
Client (x-pr-id: 123) â†’ productpage-stable â†’ reviews-pr-123 â†’ ratings-stable

# ç¨³å®šæµé‡è¯·æ±‚é“¾
Client â†’ productpage-stable â†’ details-stable
Client â†’ productpage-stable â†’ reviews-stable â†’ ratings-stable
```

### æµé‡è½¬å‘è§„åˆ™
- **ç¨³å®šæµé‡**ï¼šæ‰€æœ‰è¯·æ±‚è·¯ç”±åˆ°å¯¹åº”æœåŠ¡Stableç‰ˆæœ¬
- **PRæµé‡**ï¼š
  - æœªå˜æ›´æœåŠ¡ï¼šè¯·æ±‚è·¯ç”±åˆ°Stableç‰ˆæœ¬
  - å˜æ›´æœåŠ¡ï¼šè¯·æ±‚è·¯ç”±åˆ°å¯¹åº”PRç‰ˆæœ¬
- **è‡ªåŠ¨ä¼ é€’**ï¼š`x-pr-id`å¤´åœ¨æœåŠ¡é—´è‡ªåŠ¨ä¼ é€’ï¼Œç¡®ä¿è°ƒç”¨é“¾æ­£ç¡®è·¯ç”±

### PRæ ‡è¯†ä¼ æ’­æœºåˆ¶
- **OpenTelemetry Baggage**ï¼šæœåŠ¡é—´è‡ªåŠ¨ä¼ é€’`x-pr-id`æ ‡è¯†
- **Istioæ™ºèƒ½è·¯ç”±**ï¼š
  - æ£€æµ‹è¯·æ±‚æ˜¯å¦å¸¦`x-pr-id`å¤´
  - æ£€æŸ¥æœåŠ¡æ˜¯å¦æœ‰å¯¹åº”PRç‰ˆæœ¬
  - è·¯ç”±åˆ°æ­£ç¡®æœåŠ¡ç‰ˆæœ¬
- **æŒ‰éœ€éƒ¨ç½²**ï¼šä»…ä¸ºå˜æ›´æœåŠ¡ç”ŸæˆPRç‰ˆæœ¬éƒ¨ç½²é…ç½®
- **èµ„æºä¼˜åŒ–**ï¼šä»…éƒ¨ç½²å˜æ›´æœåŠ¡PRç‰ˆæœ¬ï¼Œå‡å°‘èµ„æºæ¶ˆè€—

---

## ğŸš€ éƒ¨ç½²ä¸æµ‹è¯•æŒ‡å—

### 1. å®‰è£… Istio Ambient Mesh ç¯å¢ƒ

```bash
# ä¸‹è½½å¹¶å®‰è£… Istio
curl -L https://istio.io/downloadIstio | sh -
cd istio-1.28.2
export PATH=$PWD/bin:$PATH

# å®‰è£… Istio Ambient Mesh é…ç½®æ–‡ä»¶
istioctl install --set profile=ambient --skip-confirmation

# å®‰è£… Gateway API CRDï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰
kubectl get crd gateways.gateway.networking.k8s.io &> /dev/null || \
kubectl apply -f https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.4.0/standard-install.yaml
```

### 2. éƒ¨ç½²åº”ç”¨ä¸é…ç½®

```bash
# éƒ¨ç½² Bookinfo ç¨³å®šç‰ˆæœ¬æœåŠ¡
kubectl apply -f k8s/bookinfo-stable.yaml

# éƒ¨ç½² Gateway èµ„æºï¼Œå®šä¹‰å¤–éƒ¨æµé‡å…¥å£
kubectl apply -f k8s/bookinfo-gateway.yaml

# ä¸º bookinfo å‘½åç©ºé—´å¯ç”¨ Ambient æ•°æ®é¢æ¨¡å¼
kubectl label namespace bookinfo istio.io/dataplane-mode=ambient

# ä¸º bookinfo å‘½åç©ºé—´åˆ›å»ºå¹¶ç»‘å®š Waypoint ä»£ç†
istioctl waypoint apply --enroll-namespace -n bookinfo --wait

# é…ç½® Gateway æœåŠ¡ç±»å‹ä¸º ClusterIPï¼ˆç”¨äºæœ¬åœ°å¼€å‘ç¯å¢ƒçš„ç«¯å£è½¬å‘ï¼‰
kubectl annotate gateway bookinfo-gateway networking.istio.io/service-type=ClusterIP --namespace=bookinfo

# å°†æœ¬åœ° 8080 ç«¯å£è½¬å‘åˆ° Istio ç½‘å…³æœåŠ¡
kubectl port-forward svc/bookinfo-gateway-istio -n bookinfo 8080:80
```

### 3. æµ‹è¯• PR ç¯å¢ƒè·¯ç”±

```bash
# éƒ¨ç½²æµ‹è¯•ç”¨çš„ ratings æœåŠ¡ï¼ˆæ¨¡æ‹Ÿ PR #3 çš„ä»£ç å˜æ›´ï¼‰
kubectl apply -f k8s/deploy-ratings-pr3.yaml

# å‘èµ·æ™®é€šæµ‹è¯•è¯·æ±‚ï¼ˆè®¿é—®ç¨³å®šç‰ˆæœ¬ï¼‰
curl http://localhost:8080/productpage

# å‘èµ·é’ˆå¯¹ PR #3 çš„æµ‹è¯•è¯·æ±‚ï¼ˆæºå¸¦ x-pr-id: 3 å¤´ï¼‰
curl -s -H "x-pr-id: 3" http://localhost:8080/productpage | \
jq -r '.. | .hostname? // .rating_hostname? | select(.)'
```

### 4. æ¸…ç†èµ„æº

```bash
# åˆ é™¤æµ‹è¯• PR æœåŠ¡
kubectl delete -f k8s/deploy-ratings-pr3.yaml

# åˆ é™¤åº”ç”¨èµ„æº
kubectl delete -f k8s/bookinfo-gateway.yaml
kubectl delete -f k8s/bookinfo-stable.yaml

```


## ğŸ”® æœªæ¥è®¡åˆ’

ç›®å‰æˆ‘ä»¬çš„æ–¹æ¡ˆä½¿ç”¨ç®€å•çš„æ— çŠ¶æ€å¾®æœåŠ¡ä¸ºä¾‹ï¼Œé€šè¿‡HTTPæˆ–gRPCç­‰L7åè®®å®ç°è¯·æ±‚æ ‡è®°å’Œè·¯ç”±ï¼Œè¿™åœ¨åŸºæœ¬åœºæ™¯ä¸‹éå¸¸æœ‰æ•ˆã€‚ä½†åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿˜éœ€è¦è€ƒè™‘æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰æœ‰çŠ¶æ€èµ„æºçš„éš”ç¦»é—®é¢˜ã€‚ä¾‹å¦‚å¯¹äºæ•°æ®åº“å¯ä»¥é‡‡ç”¨æ–°å»ºschemaæˆ–è€…åœ¨å¯åŠ¨æ—¶åŠ¨æ€æ‹‰èµ·ä¸´æ—¶çš„æ•°æ®åº“ç­‰æ–¹å¼ï¼Œå¯¹äºæ¶ˆæ¯é˜Ÿåˆ—åˆ™å¯ä»¥é‡‡ç”¨å¤štopicæ–¹å¼ï¼Œå…·ä½“å®ç°è§†åœºæ™¯è€Œå®šã€‚